Mmenu.addons.offCanvas=function(){if(this.opts.offCanvas){var e=this.opts.offCanvas,o=this.conf.offCanvas;this._api.push("open","close","setPage"),"object"!=typeof e&&(e={}),e=this.opts.offCanvas=jQuery.extend(!0,{},Mmenu.options.offCanvas,e),"string"!=typeof o.page.selector&&(o.page.selector="> "+o.page.nodetype),o=this.conf.offCanvas=jQuery.extend(!0,{},Mmenu.configs.offCanvas,o),this.vars.opened=!1,this.bind("initMenu:after",function(){var e=this;this._initBlocker(),this.setPage(Mmenu.node.$page),this._initWindow_offCanvas(),this.node.$menu.addClass("mm-menu_offcanvas").parent(".mm-wrapper").removeClass("mm-wrapper"),this.node.$menu[o.menu.insertMethod](o.menu.insertSelector);var n=window.location.hash;if(n){var t=this._getOriginalMenuId();t&&t==n.slice(1)&&setTimeout(function(){e.open()},1e3)}}),this.bind("setPage:after",function(e){Mmenu.node.$blck&&Mmenu.node.$blck.children("a").attr("href","#"+e.attr("id"))}),this.bind("open:start:sr-aria",function(){Mmenu.sr_aria(this.node.$menu,"hidden",!1)}),this.bind("close:finish:sr-aria",function(){Mmenu.sr_aria(this.node.$menu,"hidden",!0)}),this.bind("initMenu:after:sr-aria",function(){Mmenu.sr_aria(this.node.$menu,"hidden",!0)}),this.bind("initBlocker:after:sr-text",function(){Mmenu.node.$blck.children("a").html(Mmenu.sr_text(this.i18n(this.conf.screenReader.text.closeMenu)))}),this.clck.push(function(e,n){var t=this,o=this._getOriginalMenuId();if(o&&e.is('[href="#'+o+'"]')){if(this.node.$menu.find(e).length)return this.open(),!0;var i=e.closest(".mm-menu");if(i.length){var s=i.data("mmenu");if(s&&s.close)return s.close(),Mmenu.__transitionend(i,function(){t.open()},this.conf.transitionDuration),!0}return this.open(),!0}if(Mmenu.node.$page)return(o=Mmenu.node.$page.first().attr("id"))&&e.is('[href="#'+o+'"]')?(this.close(),!0):void 0})}},Mmenu.options.offCanvas={blockUI:!0,moveBackground:!0},Mmenu.configs.offCanvas={menu:{insertMethod:"prependTo",insertSelector:"body"},page:{nodetype:"div",selector:null,noSelector:[],wrapIfNeeded:!0}},Mmenu.prototype.open=function(){var e=this;this.trigger("open:before"),this.vars.opened||(this._openSetup(),setTimeout(function(){e._openFinish()},this.conf.openingInterval),this.trigger("open:after"))},Mmenu.prototype._openSetup=function(){var e=this,n=this.opts.offCanvas;this.closeAllOthers(),Mmenu.node.$page.each(function(){jQuery(this).data("mm-style",jQuery(this).attr("style")||"")}),jQuery(window).trigger("resize.mm-offCanvas",[!0]);var t=["mm-wrapper_opened"];n.blockUI&&t.push("mm-wrapper_blocking"),"modal"==n.blockUI&&t.push("mm-wrapper_modal"),n.moveBackground&&t.push("mm-wrapper_background"),jQuery("html").addClass(t.join(" ")),setTimeout(function(){e.vars.opened=!0},this.conf.openingInterval),this.node.$menu.addClass("mm-menu_opened")},Mmenu.prototype._openFinish=function(){var e=this;Mmenu.__transitionend(Mmenu.node.$page.first(),function(){e.trigger("open:finish")},this.conf.transitionDuration),this.trigger("open:start"),jQuery("html").addClass("mm-wrapper_opening")},Mmenu.prototype.close=function(){var e=this;this.trigger("close:before"),this.vars.opened&&(Mmenu.__transitionend(Mmenu.node.$page.first(),function(){e.node.$menu.removeClass("mm-menu_opened");jQuery("html").removeClass(["mm-wrapper_opened","mm-wrapper_blocking","mm-wrapper_modal","mm-wrapper_background"].join(" ")),Mmenu.node.$page.each(function(){var e=jQuery(this).data("mm-style");jQuery(this).attr("style",e)}),e.vars.opened=!1,e.trigger("close:finish")},this.conf.transitionDuration),this.trigger("close:start"),jQuery("html").removeClass("mm-wrapper_opening"),this.trigger("close:after"))},Mmenu.prototype.closeAllOthers=function(){jQuery("body").find(".mm-menu_offcanvas").not(this.node.$menu).each(function(){var e=jQuery(this).data("mmenu");e&&e.close&&e.close()})},Mmenu.prototype.setPage=function(e){this.trigger("setPage:before",[e]);var n=this.conf.offCanvas;e&&e.length||(e=jQuery("body").find(n.page.selector).not(".mm-menu").not(".mm-wrapper__blocker"),n.page.noSelector.length&&(e=e.not(n.page.noSelector.join(", "))),1<e.length&&n.page.wrapIfNeeded&&(e=e.wrapAll("<"+n.page.nodetype+" />").parent())),e.addClass("mm-page mm-slideout").each(function(){jQuery(this).attr("id",jQuery(this).attr("id")||Mmenu.__getUniqueId())}),Mmenu.node.$page=e,this.trigger("setPage:after",[e])},Mmenu.prototype._initWindow_offCanvas=function(){var t,o;jQuery(window).off("keydown.mm-offCanvas").on("keydown.mm--offCanvas",function(e){if(jQuery("html").hasClass("mm-wrapper_opened")&&9==e.keyCode)return e.preventDefault(),!1}),jQuery(window).off("resize.mm-offCanvas").on("resize.mm-offCanvas",function(e,n){1==Mmenu.node.$page.length&&(n||jQuery("html").hasClass("mm-wrapper_opened"))&&(o=jQuery(window).height(),(n||o!=t)&&(t=o,Mmenu.node.$page.css("minHeight",o)))})},Mmenu.prototype._initBlocker=function(){var n=this,e=this.opts.offCanvas,t=this.conf.offCanvas;this.trigger("initBlocker:before"),e.blockUI&&(Mmenu.node.$blck||(Mmenu.node.$blck=jQuery('<div class="mm-wrapper__blocker mm-slideout" />').append("<a />")),Mmenu.node.$blck.appendTo(t.menu.insertSelector).off("touchstart.mm-offCanvas touchmove.mm-offCanvas").on("touchstart.mm-offCanvas touchmove.mm-offCanvas",function(e){e.preventDefault(),e.stopPropagation(),Mmenu.node.$blck.trigger("mousedown.mm-offCanvas")}).off("mousedown.mm-offCanvas").on("mousedown.mm-offCanvas",function(e){e.preventDefault(),jQuery("html").hasClass("mm-wrapper_modal")||(n.closeAllOthers(),n.close())}),this.trigger("initBlocker:after"))};